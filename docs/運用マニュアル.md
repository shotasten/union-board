# 運用マニュアル

出欠管理アプリの日常的な運用方法を説明します。

## 基本操作

### イベントの作成

1. Webアプリにアクセス
2. ヘッダーの「+ 新しいイベントを作成」ボタンをクリック
3. イベント情報を入力：
   - **タイトル**: イベント名（デフォルト: "練習"）
   - **開始日時**: イベントの開始日時
   - **終了日時**: イベントの終了日時
   - **終日**: チェックすると終日イベントになります
   - **場所**: 練習場所（履歴から選択可能）
   - **説明**: イベントの詳細説明
4. 「保存」をクリック

**注意**: イベント作成には管理者トークンが必要です。管理者トークンは `localStorage` に保存されます。

### イベントの編集

1. イベントカードの右上の「編集」ボタン（✏️）をクリック
2. イベント情報を編集
3. 「保存」をクリック

### イベントの削除

1. イベントカードの右上の「削除」ボタン（🗑️）をクリック
2. 確認ダイアログで「削除」をクリック

**注意**: 削除は論理削除（status: 'deleted'）で、実際にはデータは残ります。

### 出欠登録

1. イベントカードの「○ 出席」「△ 未定」「× 欠席」ボタンをクリック
2. 必要に応じてコメントを入力
3. 「送信」をクリック

### 出欠状況の確認

- イベントカードの下部に、出欠集計が表示されます
- 「○: X人」「△: Y人」「×: Z人」「合計: N人」の形式で表示されます

## カレンダー連携

### カレンダー同期

1. **個別イベントの同期**:
   - イベントカードの「同期」ボタン（🔄）をクリック
   - カレンダーにイベントが作成・更新されます

2. **全イベントの同期**:
   - ヘッダーの「🔄 全イベント同期」ボタンをクリック
   - すべてのイベントがカレンダーと同期されます

### カレンダー → アプリ同期

- カレンダーでイベントを編集した場合、次回の同期時にアプリに反映されます
- ただし、出欠情報はアプリ側が優先されます

## 管理者機能

### 管理者トークンの設定

1. GASエディタで `utils.gs` を選択
2. 関数選択で `testConfig` を選択
3. 「実行」をクリック
4. 実行ログから `ADMIN_TOKEN` の値をコピー
5. Webアプリのブラウザコンソールで以下を実行：

```javascript
localStorage.setItem('adminToken', 'YOUR_ADMIN_TOKEN');
```

### 管理者機能の使用

管理者トークンが設定されている場合、以下の機能が使用可能になります：

- イベントの作成
- イベントの編集
- イベントの削除

## 場所履歴機能

### 場所履歴の使用

1. イベント作成・編集フォームで「場所」入力欄の横の「📋」ボタンをクリック
2. 直近の3-5件の場所履歴が表示されます
3. 場所をクリックすると、入力欄に自動入力されます

## トラブルシューティング

### イベントが表示されない

- ブラウザをリロード
- イベントの開始日時が未来であることを確認（過去のイベントは表示されません）

### 出欠登録ができない

- 表示名が設定されているか確認
- ブラウザのコンソールでエラーを確認

### カレンダー同期が失敗する

- カレンダーIDが正しく設定されているか確認（Configシート）
- カレンダーへのアクセス権限を確認

### 管理者機能が使えない

- 管理者トークンが正しく設定されているか確認
- `localStorage.getItem('adminToken')` で確認

## データ管理

### Spreadsheetの確認

1. GASエディタで `utils.gs` を選択
2. 関数選択で `testConfig` を選択
3. 「実行」をクリック
4. 実行ログから Spreadsheet URL を確認
5. Spreadsheetを開いてデータを確認

### データのバックアップ

- Spreadsheetのデータは自動的にGoogleドライブに保存されます
- 定期的にSpreadsheetをダウンロードしてバックアップを取ることを推奨します

### データの復元

- Spreadsheetから直接データを編集・復元できます
- ただし、データ形式に注意してください

## パフォーマンス

### 最適化

- イベント数が多くなった場合、パフォーマンスが低下する可能性があります
- 定期的に古いイベントをアーカイブすることを推奨します

### キャッシュ

- ブラウザのキャッシュをクリアすると、最新のデータが表示されます
- `localStorage` のデータをクリアする場合は注意してください

## セキュリティ

### 管理者トークンの管理

- 管理者トークンは安全な場所に保管してください
- トークンが漏洩した場合は、`testConfig` を再実行して新しいトークンを生成してください

### レート制限

- 匿名モードでは、レート制限（5回/分）が適用されます
- 制限に達した場合は、しばらく待ってから再試行してください

## サポート

問題が発生した場合は、以下を確認してください：

1. ブラウザのコンソールでエラーを確認
2. GASエディタの実行ログを確認
3. Spreadsheetのデータを確認

それでも解決しない場合は、開発者に連絡してください。

