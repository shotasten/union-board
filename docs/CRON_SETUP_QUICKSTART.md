# 定期同期（cron）設定クイックスタート

## 📋 概要

出欠保存時のカレンダー同期をスキップしたため、カレンダーへの反映は**定期同期（cron）**で自動実行する必要があります。

**実装状況**: ✅ `scheduledSync()`関数は既に実装済み  
**設定状況**: ⚠️ トリガーの設定が必要

---

## 🚀 設定手順（5分で完了）

### 1. Google Apps Script エディタを開く

1. スプレッドシートを開く
2. **拡張機能** → **Apps Script** をクリック

### 2. トリガーを追加

1. 左側メニューから **「トリガー」**（時計アイコン）をクリック
2. 右下の **「+ トリガーを追加」** をクリック

### 3. トリガーの設定

以下のように設定してください：

| 項目 | 設定値 |
|------|--------|
| **実行する関数** | `scheduledSync` |
| **イベントのソース** | `時間主導型` |
| **時間ベースのトリガー** | `15分おき`（推奨） |
| **エラー通知設定** | `即座に通知を受け取る`（推奨） |

### 4. 保存

1. **「保存」** をクリック
2. 初回実行時に権限の承認が求められる場合があります
   - 「権限を確認」をクリック
   - Googleアカウントを選択
   - 「詳細」→「[プロジェクト名]に移動」をクリック
   - 「許可」をクリック

---

## ✅ 設定完了の確認

### 方法1: トリガー一覧で確認

1. GASエディタの「トリガー」タブを開く
2. `scheduledSync` のトリガーが表示されていることを確認
3. 状態が「有効」になっていることを確認

### 方法2: 実行ログで確認

1. GASエディタの「実行数」タブを開く
2. 15分後に `scheduledSync` の実行履歴が表示されることを確認
3. ログに以下が表示されれば成功：
   ```
   ✅ 定期同期完了: 成功 X件, 失敗 0件
   ```

---

## 📊 動作確認

### 出欠保存の動作

1. **出欠を保存** → 即座に完了（2-3秒）
2. **カレンダー反映** → 最大15分後に自動反映（定期同期で）

### 手動同期（即座に反映したい場合）

1. アプリにアクセス
2. 管理者ログイン
3. ヘッダーの **「🔄」（同期）ボタン** をクリック
4. 即座にカレンダーに反映されます

---

## ⚙️ 推奨設定

### トリガー頻度

| 頻度 | メリット | デメリット | 推奨度 |
|------|---------|----------|--------|
| **5分おき** | 反映が速い | API呼び出しが多い | ⭐⭐ |
| **15分おき** ⭐ | バランスが良い | 標準的な反映速度 | ⭐⭐⭐ |
| **1時間おき** | API呼び出しが少ない | 反映が遅い | ⭐ |

**推奨: 15分おき**
- カレンダー側の変更が15分以内に反映される
- API呼び出し回数も適切（1日96回）
- Google Apps Script の実行時間制限にも余裕

---

## 🔧 トラブルシューティング

### トリガーが実行されない

**原因:**
- トリガーが正しく設定されていない
- 関数名が間違っている（`scheduledSync` であることを確認）

**対処法:**
1. トリガー設定を確認（関数名: `scheduledSync`）
2. トリガーを削除して再度追加
3. 実行ログでエラーを確認

### カレンダーに反映されない

**原因:**
- トリガーが停止している
- 表示期間外のイベントを編集している

**対処法:**
1. トリガーが有効になっているか確認
2. 編集したイベントが表示期間内か確認
3. 手動で同期ボタンを押して確認

---

## 📝 補足

### 表示期間の設定

定期同期は**表示期間（DISPLAY_START_DATE ～ DISPLAY_END_DATE）**のイベントのみを同期します。

**設定方法:**
1. アプリにアクセス
2. 管理者ログイン
3. 設定パネル → 表示期間を設定
4. `DISPLAY_START_DATE`: 例 `2025-04-01`
5. `DISPLAY_END_DATE`: 例 `2026-03-31`

表示期間が未設定の場合、デフォルト期間（30日前～1年後）が適用されます。

---

## 🎯 まとめ

✅ **実装済み**: `scheduledSync()`関数  
✅ **設定必要**: GASエディタからトリガーを追加  
✅ **推奨頻度**: 15分おき  
✅ **効果**: 出欠保存が高速化（30秒 → 2-3秒）

設定後、カレンダーへの反映は自動的に行われます！

